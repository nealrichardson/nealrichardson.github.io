<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Collect API Responses as Mock Files — capture_requests • httptest</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="Collect API Responses as Mock Files — capture_requests" />

<meta property="og:description" content="capture_requests is a context that collects the responses from requests
you make and stores them as mock files. This enables you to perform a series
of requests against a live server once and then build your test suite using
those mocks, running your tests in with_mock_API().
start_capturing and stop_capturing allow you to turn on/off request
recording for more convenient use in an interactive session." />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104182925-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">httptest</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/httptest.html">Get Started</a>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/httptest.html">Overview</a>
    </li>
    <li>
      <a href="../articles/redacting.html">Redacting Sensitive Information</a>
    </li>
    <li>
      <a href="../index.html#faq">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nealrichardson/httptest">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://enpiar.com">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Collect API Responses as Mock Files</h1>
    </div>

    
    <p><code>capture_requests</code> is a context that collects the responses from requests
you make and stores them as mock files. This enables you to perform a series
of requests against a live server once and then build your test suite using
those mocks, running your tests in <code><a href='with_mock_API.html'>with_mock_API()</a></code>.
<code>start_capturing</code> and <code>stop_capturing</code> allow you to turn on/off request
recording for more convenient use in an interactive session.</p>
    

    <pre class="usage"><span class='fu'>capture_requests</span>(<span class='no'>expr</span>, <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='mockPaths.html'>.mockPaths</a></span>()[<span class='fl'>1</span>], <span class='kw'>simplify</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>redact</span> <span class='kw'>=</span> <span class='no'>redact_auth</span>)

<span class='fu'>start_capturing</span>(<span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='mockPaths.html'>.mockPaths</a></span>()[<span class='fl'>1</span>], <span class='kw'>simplify</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>redact</span> <span class='kw'>=</span> <span class='no'>redact_auth</span>)

<span class='fu'>stop_capturing</span>()</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>Code to run inside the context</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>Where to save the mock files. Default is the first directory in
<code><a href='mockPaths.html'>.mockPaths()</a></code>, which if not otherwise specified is the current working
directory.</p></td>
    </tr>
    <tr>
      <th>simplify</th>
      <td><p>logical: if <code>TRUE</code> (default), JSON responses with status 200
will be written as just the text of the response body. In all other cases,
and when <code>simplify</code> is <code>FALSE</code>, the "response" object will be written out to
a .R file using <code><a href='http://www.rdocumentation.org/packages/base/topics/dput'>base::dput()</a></code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical: if <code>TRUE</code>, a <code>message</code> is printed for every file
that is written when capturing requests containing the absolute path of the
file. Useful for debugging if you're capturing but don't see the fixture
files being written in the expected location. Default is <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>redact</th>
      <td><p>function to run to purge sensitive strings from the recorded
response objects. It should take a <code>response</code>-class object as its argument
and should return a cleansed <code>response</code> object. This allows you to remove
certain request and response contents, such as authentication tokens, from
the mocks that get written out. See <code><a href='redact.html'>redact_auth()</a></code>, the default, for more
details.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>capture_requests</code> returns the result of <code>expr</code>. <code>start_capturing</code>
invisibly returns the <code>path</code> it is given. <code>stop_capturing</code> returns nothing;
it is called for its side effects.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Mocks stored by this context are written out as plain-text files, either with
extension <code>.json</code> if the request returned JSON content or with extension <code>.R</code>
otherwise. The <code>.R</code> files contain syntax that when executed recreates the
<code>httr</code> "response" object. By storing fixtures as plain-text files, you can
more easily confirm that your mocks look correct, and you can more easily
maintain them without having to re-record them. If the API changes subtly,
such as when adding an additional attribute to an object, you can just touch
up the mocks.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'>capture_requests</span>({
    <span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/get"</span>)
    <span class='fu'>GET</span>(<span class='st'>"http://httpbin.org"</span>)
    <span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/response-headers"</span>,
        <span class='kw'>query</span><span class='kw'>=</span><span class='fu'>list</span>(<span class='kw'>`Content-Type`</span><span class='kw'>=</span><span class='st'>"application/json"</span>))
})
<span class='co'># Or:</span>
<span class='fu'>start_capturing</span>()
<span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/get"</span>)
<span class='fu'>GET</span>(<span class='st'>"http://httpbin.org"</span>)
<span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/response-headers"</span>,
    <span class='kw'>query</span><span class='kw'>=</span><span class='fu'>list</span>(<span class='kw'>`Content-Type`</span><span class='kw'>=</span><span class='st'>"application/json"</span>))
<span class='fu'>stop_capturing</span>()
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Neal Richardson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
