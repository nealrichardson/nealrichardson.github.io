<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Record API responses as mock files — capture_requests • httptest</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="Record API responses as mock files — capture_requests" />

<meta property="og:description" content="capture_requests is a context that collects the responses from requests
you make and stores them as mock files. This enables you to perform a series
of requests against a live server once and then build your test suite using
those mocks, running your tests in with_mock_api()." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104182925-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-104182925-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">httptest</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">3.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/httptest.html">Get Started</a>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/httptest.html">Overview</a>
    </li>
    <li>
      <a href="../articles/redacting.html">Redacting Sensitive Information</a>
    </li>
    <li>
      <a href="../articles/vignettes.html">Using with Vignettes</a>
    </li>
    <li>
      <a href="../index.html#faq">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nealrichardson/httptest">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://enpiar.com">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Record API responses as mock files</h1>
    <small class="dont-index">Source: <a href='https://github.com/nealrichardson/httptest/blob/master/R/capture-requests.R'><code>R/capture-requests.R</code></a></small>
    <div class="hidden name"><code>capture_requests.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>capture_requests</code> is a context that collects the responses from requests
you make and stores them as mock files. This enables you to perform a series
of requests against a live server once and then build your test suite using
those mocks, running your tests in <code><a href='with_mock_api.html'>with_mock_api()</a></code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>capture_requests</span>(<span class='no'>expr</span>, <span class='no'>path</span>, <span class='no'>...</span>)

<span class='fu'>start_capturing</span>(<span class='no'>path</span>, <span class='kw'>simplify</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>verbose</span>, <span class='no'>redact</span>)

<span class='fu'>stop_capturing</span>()</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>Code to run inside the context</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>Where to save the mock files. Default is the first directory in
<code><a href='mockPaths.html'>.mockPaths()</a></code>, which if not otherwise specified is the current working
directory. It is generally better to call <code><a href='mockPaths.html'>.mockPaths()</a></code> directly if you
want to write to a different path, rather than using the <code>path</code> argument.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed through <code>capture_requests</code> to <code>start_capturing</code></p></td>
    </tr>
    <tr>
      <th>simplify</th>
      <td><p>logical: if <code>TRUE</code> (default), JSON responses with status 200
will be written as just the text of the response body. In all other cases,
and when <code>simplify</code> is <code>FALSE</code>, the "response" object will be written out to
a .R file using <code><a href='http://www.rdocumentation.org/packages/base/topics/dput'>base::dput()</a></code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical: if <code>TRUE</code>, a <code>message</code> is printed for every file
that is written when capturing requests containing the absolute path of the
file. Useful for debugging if you're capturing but don't see the fixture
files being written in the expected location. Default is <code>FALSE</code>. This
parameter is deprecated; it is instead recommended that you set
<code>options(httptest.verbose=TRUE)</code> to enable.</p></td>
    </tr>
    <tr>
      <th>redact</th>
      <td><p>function to run to purge sensitive strings from the recorded
response objects. This argument is deprecated: use <code><a href='set_redactor.html'>set_redactor()</a></code> or a
package redactor instead. See <code><a href='../articles/redacting.html'>vignette("redacting")</a></code> for more details.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>capture_requests</code> returns the result of <code>expr</code>. <code>start_capturing</code>
invisibly returns the <code>path</code> it is given. <code>stop_capturing</code> returns nothing;
it is called for its side effects.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>start_capturing</code> and <code>stop_capturing</code> allow you to turn on/off request
recording for more convenient use in an interactive session.</p>
<p>Recorded responses are written out as plain-text files. By storing fixtures
as plain-text files, you can
more easily confirm that your mocks look correct, and you can more easily
maintain them without having to re-record them. If the API changes subtly,
such as when adding an additional attribute to an object, you can just touch
up the mocks.</p>
<p>If the response has status <code>200 OK</code> and the <code>Content-Type</code>
maps to a supported file extension---currently <code>.json</code>,
<code>.html</code>, <code>.xml</code>, <code>.txt</code>, <code>.csv</code>, and <code>.tsv</code>---just the response body will be
written out, using the appropriate extension. <code>204 No Content</code> status
responses will be stored as an empty file with extension <code>.204</code>. Otherwise,
the response will be written as a <code>.R</code> file containing syntax that, when
executed, recreates the
<code>httr</code> "response" object.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='build_mock_url.html'>build_mock_url()</a></code> for how requests are translated to file paths</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'>capture_requests</span>({
    <span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/get"</span>)
    <span class='fu'>GET</span>(<span class='st'>"http://httpbin.org"</span>)
    <span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/response-headers"</span>,
        <span class='kw'>query</span><span class='kw'>=</span><span class='fu'>list</span>(<span class='kw'>`Content-Type`</span><span class='kw'>=</span><span class='st'>"application/json"</span>))
})
<span class='co'># Or:</span>
<span class='fu'>start_capturing</span>()
<span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/get"</span>)
<span class='fu'>GET</span>(<span class='st'>"http://httpbin.org"</span>)
<span class='fu'>GET</span>(<span class='st'>"http://httpbin.org/response-headers"</span>,
    <span class='kw'>query</span><span class='kw'>=</span><span class='fu'>list</span>(<span class='kw'>`Content-Type`</span><span class='kw'>=</span><span class='st'>"application/json"</span>))
<span class='fu'>stop_capturing</span>()
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Neal Richardson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

